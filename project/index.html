<!DOCTYPE html>
    <html>
        <head lang="en">
            <meta charset="UTF-8">
            <title>Ultra Rapid Figures</title>
        
            <!-- ADD Libraries-->
            <script src="libs/d3/d3.min.js" charset="utf-8"></script>
            <script src="http://d3js.org/queue.v1.min.js"></script>
            <script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
            <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
        
        
            <!--Stylesheets-->
            <link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">
        
            <!-- Get some nice font-->
            <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>
        
            <!-- add own vis classes-->
            <script src = "js/force.js"></script>
            <script src = "js/item_bar.js"></script>
            <script src = "js/KDA.js"></script>
            <script src = "js/game_duration.js"></script>
        
            <!-- add own stylesheet-->
            <!--link rel="stylesheet" type="text/css" href="css/myStyle.css">-->
        
        </head>
        
        <body>
            <div id = "force_filter">
                
            </div>
            <div id = "durationArea">
                
            </div>
            <div id = "barVis">
                
            </div>
            <div id = "KDAVis">
                <form action="">
                <input type="radio" name="kda" value="kills" checked>Kills<br>
                <input type="radio" name="kda" value="deaths">Deaths<br>
                <input type="radio" name="kda" value="assists">Assists<br>
                </form>
                
            </div>
            
        </body>
        
        <script>
            $(function(){ // this function is called after the HTML document is fully loaded
    
    
                //==========================================
                //--- HERE IS WHERE ALL THE MAGIC STARTS --
                //==========================================
    
    
                // variables keeping global knowledge of the data
                var allData = [];
                var metaData = {};
                
                // this function can convert Date objects to a string
                // it can also convert strings to Date objects
                // see: https://github.com/mbostock/d3/wiki/Time-Formatting
                var dateFormatter = d3.time.format("%Y-%m-%d");
    
    
                // call this function after Data is loaded, reformatted and bound to the variables
                var initVis = function(){
    
                    
                    var MyEventHandler = new Object();
                    
                    var force = new ForceVis(d3.select("#force_filter"), allData, metaData, MyEventHandler);
                    //var duration_area = new DurationVis(d3.select("durationVis"), allData);
                    var bar_items = new BarVis(d3.select("#barVis"), allData);
                    // var kda_area = new AreaVis(d3.select("kdaAreaVis"), allData)
                    var MyKDAVis = new KDAVis(d3.select("#KDAVis"), allData, metaData);
                    var game_vis = new DurationVis(d3.select("#durationArea"), allData, metaData, MyEventHandler);
                    
                    $(MyEventHandler).bind("brushed", function(event, data) {
                        force.onSelectionChange(data)
                        
                    })
                    
                    
                    $(MyEventHandler).bind("selectionChanged", function(event, selected){
                        MyKDAVis.onSelectionChange(selected);
                    });

                    $(MyEventHandler).bind("brushed", function(event, start, end){
                        MyKDAVis.brushChange(start,end);
                        force.brushChange(start,end);
                    });

                    $(MyEventHandler).bind("kdaRadioChange", function(event, selected){
                        MyKDAVis.kdaRadioChange(selected);
                    });

                    d3.selectAll("input[type='radio'][name='kda']")
                        .on("change", function() {
                            d3.selectAll("input[type='radio'][name='kda']")
                                .each(function() {
                                    if(d3.select(this).property("checked")) {
                                        //encoder = d3.select(this).attr("value")
                                        $(MyEventHandler).trigger("kdaRadioChange", d3.select(this).attr("value"));
                                    }
                                })
                        })

    
                }
    
                // call this function after both files are loaded -- error should be "null" if no error
                var dataLoaded = function (error, _allData, _metaData) {
                    
                    
                    if (!error) {
    
                        var newData = []
                        var keys = Object.keys(_allData)
                        for (var i = 0; i < keys.length; i ++) {
                            var temp = _allData[keys[i]]
                            temp["id"] = keys[i]
                            newData.push(temp)
                        }
                        allData = newData
                        metaData = _metaData
                        
    
                        initVis();
                        
                    }
                }
    
                var startHere = function(){
    
                    
                    queue()
                        .defer(d3.json, 'data/master_json_small.json')
                        .defer(d3.json, 'data/meta_data.json')
                        .await(dataLoaded)
                    
                    
            
                }
    
                startHere();
            })
            
            
            
            
            
            
            
            
        </script>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </html>